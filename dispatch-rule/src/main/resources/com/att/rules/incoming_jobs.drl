package com.att.rules;

import com.att.dispatch.rule.model.Turf;
import com.att.dispatch.rule.model.Job;

global  com.att.dispatch.rule.process.JobPool job_pool
global  com.att.dispatch.rule.process.TurfPool turf_pool

rule "a pending job"
  no-loop true
when
   $new_job: Job( $id : id ,  $turfID : turfID , $status: status =="PENDING"  )
   not (exists (Job(id == $id , status != $status, turfID !=  $turfID )) )
then
   Turf turf = turf_pool.find( $turfID.toString() );
   //insert new job into the turf rule to update the turf
   modify($new_job){ setTurfName(turf.getName()) }
   insert(turf);
end


rule "a job is dispatched"
no-loop true
when
  $dispatched_job: Job( $id : id , $turfID : turfID, $status: status == "DISPATCHED" )
   not (exists (Job(id == $id , status != $status, turfID !=  $turfID )) )
then
   //find the turf in the datastore 
   Turf turf = turf_pool.find( $turfID.toString() );
   //pass facts to the turf rules
   modify($dispatched_job){ setTurfName(turf.getName()) }
   insert(turf);
end
