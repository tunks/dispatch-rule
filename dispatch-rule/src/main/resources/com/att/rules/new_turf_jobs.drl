package com.att.rules;

import com.att.dispatch.rule.model.Turf;
import com.att.dispatch.rule.model.Job;
import com.att.dispatch.rule.model.Analytic;

global  com.att.dispatch.rule.process.JobPool job_pool
global  com.att.dispatch.rule.process.TurfPool turf_pool

/*********  PENDING RULE - starts here *******************/
rule "a pending job is added,create a status group"
when
    $job: Job($status: status == "PENDING" , $turfID : turfID)
    $turf: Turf(id ==  $turfID , $groups: groups)
    Boolean(booleanValue == false) from $groups.containsKey($status)
then 
    int value = 1;
    //update the total number of jobs by 1
    $turf.setTotalNumberOfJobs( $turf.getTotalNumberOfJobs() +value);
    $turf.getGroups().put($status,new Group($status,value));
    //update store
    //send message to notifier
    Message msg = new Message();
    msg.add("messages:turfs:jobs", job_pool.save($job));
    msg.add("turfs", turf_pool.save($turf));
    insert(msg);
end
